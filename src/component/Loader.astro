<section class="bg-transparent h-full w-full flex flex-col items-center justify-center z-[100000] relative" id="loader-main">
  <div class="flex flex-row gap-[5px] items-center" id="main">
    <div class="w-fit h-[70px]" id="loader-1">
      <img src="/img/assets/load-1.svg" alt="" class="h-full" />
    </div>
    <div class="w-[19px] h-[19px] bg-blu flex items-center justify-center relative" id="loader-2">
      <div class="w-[12px] h-[12px] bg-blu absolute" id="loader-2-1"></div>
      <div class="w-[12px] h-[12px] bg-blu absolute" id="loader-2-2"></div>
      <div class="w-[12px] h-[12px] bg-blu absolute" id="loader-2-3"></div>
      <div class="w-[12px] h-[12px] bg-blu absolute" id="loader-2-4"></div>
    </div>
    <div class="w-fit h-[42.8px]" id="loader-3">
      <img src="/img/assets/load-2.svg" alt="" class="h-full" />
    </div>
  </div>

  <style>
    #loader-2,
    #loader-2-1,
    #loader-2-2,
    #loader-2-3,
    #loader-2-4 {
      border-radius: 10000px;
    }
  </style>
  <script>
    import gsap from "gsap";
    import { stopLenis, startLenis } from "../libs/main.js";

    document.addEventListener("astro:page-load", () => {
      if (window.location.pathname === "/") {
        console.log("Loader partito");
        const overlay = document.getElementById("overlayhome");
        function fadeOut() {
          setTimeout(() => overlay.classList.add("fadeout"), 10);
          setTimeout(() => overlay.classList.add("hidden"), 100);
        }

        const header = document.querySelector("header");
        header?.classList.add("hidden");
        stopLenis();

        gsap
          .timeline({
            onComplete: () => {
              startLenis();
              fadeOut();
              console.log("Loader finito");
              header?.classList.remove("hidden");
            }
          })
          .to(
            "#loader-1",
            {
              opacity: 0,
              delay: 0.3,
              duration: 0.35,
              ease: "power1.inOut"
            },
            0
          )
          .to(
            "#loader-3",
            {
              opacity: 0,
              delay: 0.3,
              duration: 0.35,
              ease: "power1.inOut"
            },
            0
          )
          .to(
            "#loader-2",
            {
              x: "-268%",
              delay: 0.4,
              duration: 1,
              ease: "power2.inOut"
            },
            0
          )
          .to(
            "#loader-2-1",
            {
              x: "-350%",
              delay: 0.9,
              duration: 1,
              ease: "power2.inOut"
            },
            0
          )
          .to(
            "#loader-2-2",
            {
              x: "350%",
              delay: 0.9,
              duration: 1,
              ease: "power2.inOut"
            },
            0
          )
          .to(
            "#loader-2-3",
            {
              y: "350%",
              delay: 1.7,
              duration: 1,
              ease: "power2.inOut"
            },
            0
          )
          .to(
            "#loader-2-4",
            {
              y: "-350%",
              delay: 1.7,
              duration: 1,
              ease: "power2.inOut"
            },
            0
          )
          .to(
            "#main",
            {
              rotate: 45,
              delay: 2.5,
              duration: 1,
              ease: "power2.inOut"
            },
            0
          )
          .to(
            "#loader-2-1",
            {
              x: "0",
              delay: 3.5,
              duration: 1,
              ease: "power2.inOut"
            },
            0
          )
          .to(
            "#loader-2-2",
            {
              x: "0",
              delay: 3.5,
              duration: 1,
              ease: "power2.inOut"
            },
            0
          )
          .to(
            "#loader-2-3",
            {
              y: "0",
              delay: 3.5,
              duration: 1,
              ease: "power2.inOut"
            },
            0
          )
          .to(
            "#loader-2-4",
            {
              y: "0",
              delay: 3.5,
              duration: 1,
              ease: "power2.inOut"
            },
            0
          )
          .to(
            "#main",
            {
              scale: 10,
              delay: 4.3,
              duration: 1,
              ease: "power2.inOut"
            },
            0
          )
          .to(
            "#main",
            {
              scale: 500,
              delay: 5.2,
              duration: 0.35,
              ease: "power4.inOut"
            },
            0
          )
          .to(
            "#main",
            {
              opacity: 0,
              delay: 5.2,
              duration: 0.352,
              ease: "power2.inOut"
            },
            0
          )
          .to(
            "#loader-main",
            {
              opacity: 0,
              delay: 6,
              duration: 0.25,
              ease: "power2.inOut"
            },
            0
          )
          .to(
            "#loader-main",
            {
              display: "none",
              delay: 6.25,
              duration: 0.25,
              ease: "power2.inOut"
            },
            0
          );
      }
    });
  </script>
</section>
